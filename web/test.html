<!DOCTYPE html>
<html lang="en">

    <%@page import="java.io.FileReader"%>
    <%@page import="java.io.BufferedReader"%>
    <%@ page import="java.io.*,java.util.*, javax.servlet.*" %>
    <%@ page import="javax.servlet.http.*" %>
    <head
        <title>Bootstrap Theme Company Page</title>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <link rel="stylesheet" href="bootstrap-3.3.7/css/bootstrap.min.css">
        <link href="https://fonts.googleapis.com/css?family=Montserrat" rel="stylesheet" type="text/css">
        <link href="https://fonts.googleapis.com/css?family=Lato" rel="stylesheet" type="text/css">
        <link href="fileinput/css/fileinput.min.css" media="all" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="css/app.css">
        <link href="fileinput/css/fileinput.css" media="all" rel="stylesheet" type="text/css" />
        <link rel="stylesheet" href="css/base.css" />
        <script src="js/jquery-3.1.1.min.js"></script>
        <script src="fileinput/js/fileinput.js" type="text/javascript"></script>
        <script src="bootstrap-3.3.7/js/bootstrap.min.js" type="text/javascript"></script>
    </head>

    <body id="myPage" data-spy="scroll" data-target=".navbar" data-offset="60">
        
        <div class="top">
            <a href="#home"><img id="rotate" src="img/top.png" width="70" height="70" alt="top" /></a>
        </div>
        <!-- Nav Bar-->
        <nav class="navbar navbar-default navbar-fixed-top">
            <div class="container">
                <div class="navbar-header">
                    <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#myNavbar">
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>
                        <span class="icon-bar"></span>                        
                    </button>
                    <a class="navbar-brand" href="#myPage">
                        <p style="font-style:italic; font-weight: 700;">gScaler</p>
                    </a>
                </div>
                <div class="collapse navbar-collapse" id="myNavbar">
                    <ul class="nav navbar-nav navbar-right">
                        <li>
                            <a href="#about">ABOUT</a>
                        </li>
                        <li>
                            <a href="#draw">DRAW</a>
                        </li>
                        <li>
                            <a href="#uploadAndScale">UPLOAD & SCALE</a>
                        </li>
                        <li>
                            <a href="#analysis">ANALYSIS</a>
                        </li>
                        <li>
                            <a href="#contact">CONTACT</a>
                        </li>
                    </ul>
                </div>
            </div>
        </nav>
        <!-- Jumbotron -->
        <div id="home" class="jumbotron text-center">
            <h1>GScaler Cloud</h1>
            <input class="form-control" id="name" name="name" placeholder="Name" type="text" required>
            <p>GScaler is a tool to scale your graph up or down while guarantee the topology of resulting graph <br> similar to orginal one.</p>
        </div>
        <!-- Container (About Section) -->
        <div id="about" class="container-fluid">
            <div class="row">
                <div class="col-md-8">
                    <h2>About GScaler</h2><br>
                    <h4>
                        Enterprises and researchers often have datasets that can be represented as graphs (e.g. social networks).
                        The owner of such a graph may want to scale it down/up to a similar but smaller/larger version for some purposes
                        (e.g. for application development/system scalability test and so on). 
                    </h4><br>
                    <p>
                        Gscaler is the tool designed for such scaling, developed by Jiangwei Zhang from National University of Singapore, School of Computing.<br> Related demo paper is accepted by VLDB 2017:
                        <a href="https://drive.google.com/file/d/0B8OtlmDMlRZnUllSTThPWm9kRm8/view?usp=sharing" target="_blank">
                            GscalerCloud: A Web-Based Graph Scaling Service
                        </a><br> Research paper is published in EDBT 2016:
                        <a href="https://openproceedings.org/2016/conf/edbt/paper-68.pdf" target="_blank">
                            GSCALER: Synthetically Scaling A Given Graph
                        </a>

                    </p>
                    <br>
                    <a class="btn btndow" href="#draw">Try It Now</a>
                </div>
                <div class="col-md-4">
                    <br><br><br>
                    <div align="center"><img src="img/lo.png"></div>
                </div>
            </div>
        </div>
        <!-- Container (Draw Section) -->
        <div id="draw" class="container-fluid bg-grey">
            <div class="row">
                <div class="col-sm-7">
                    <div class="panel panel-default text-center">
                        <div class="panel-heading">
                            <h2 style="color: #FFFFFF; margin: 0px;">DRAW GRAPH NOW</h2>
                        </div>
                        <div id="drawarea" class="panel-body">
                            <script type="text/javascript" src="js/jquery.js "></script>
                            <script type="text/javascript" src="js/min.js "></script>
                            <p style="display:none; " id='main'></p>
                            <script type="text/javascript" src="js/app.js "></script>
                        </div>

                    </div>
                </div>
                <div class="col-sm-5 text-left">
                    <h2 style="color:#334d66;"> How To Use </h2>
                    <ol class="notes">
                        <li>The graph is <strong>DIRECTED</strong>, bidirectional arrow can not be used to represent
                            undirected relation.</li>
                        <br>
                        <li>Click in the open space to add a node, Ctrl-drag a node to move to adjust graph layout.</li>
                        <br>
                        <li>When a node is selected: press <strong>'DELETE'</strong> to remove the node.</li>
                        <br>
                        <li>When an edge is selected: press <strong>'L'</strong>(eft), <strong>'R'</strong>(ight) to change direction, press <strong>'DELETE'</strong> removes the edge.</li>
                        <br>
                        <li>Download the graph your draw as graph file and then upload it for scaling.</li>
                        <br>
                        <li>You can also directly upload your own graph file without drawing one, just follow the format instructions given in 
                            <strong>UPLOAD</strong> session.</li>
                    </ol>
                    <br>
                    <div class="row">
                        <div style="padding-left:40px;" class="col-md-5">
                            <button style="padding: 8px 16px;" class="btn btndow btn-lg" id="downloadLink" onclick="downloadGraphFile()">
                                Download Graph
                            </button>
                            <script>
                                function downloadGraphFile() {
                                    testTry();
                                    loadInnerHtml('edgelist.txt', 'main', 'text/html');
                                }

                                function loadInnerHtml(filename, elId, mimeType) {
                                    var elHtml = document.getElementById(elId).innerHTML;
                                    var link = document.createElement('a');
                                    mimeType = mimeType || 'text/plain';
                                    link.setAttribute('download', filename);
                                    link.setAttribute('href', 'data:' + mimeType + ';charset=utf-8,' + encodeURIComponent(elHtml));
                                    link.click();
                                }
                            </script>                            
                        </div>
                        <div class="col-md-7">
                            <a style="padding: 8px 16px;" class="btn btndow btn-lg" href="#upload">Upload &amp; Scale Graph</a>
                        </div>
                    </div>
                </div>
            </div>

        </div>
        <!-- Container (File Upload & Scale Section) -->
        <div id="uploadAndScale" class="container-fluid">
            <div class="row ">
                <div class="col-sm-5 ">
                    <h2>Upload Graph Matrix File</h2>
                    <form action="UploadAndScaleGraph.jsp" method="post"
                          enctype="multipart/form-data">
                        <input id="input-1a" type="file" name="file" class="file" data-show-preview="false">
                        <input id="nodes" type="number"  name="scaledNodeSize"
                               placeholder="Enter the number of NODEs scale to"/>    
                        <input id="edges" type="number" name="scaledEdgeSize" 
                               placeholder="Enter the number of EDGEs scale to">
                        <br/>                        
                        <input type="submit" class="btn btndow btn-lg" value="Upload File" />
                    </form>
                </div>
                <div class="col-sm-7 text-left">
                    <h2>INSTRUCTIONS</h2>
                    <ol class="notes">
                        <li>Only <strong>TEXT</strong> files are supported, we recommend '.txt' file.</li>
                        <br>
                        <li>The format of each line: <strong>[number1][tab][number2]</strong></li>
                        <br>
                        <li>For example, <strong>"1&nbsp;&nbsp;&nbsp;&nbsp;2"</strong> 
                            represents en edge point from vertex 1 to vertex 2 (noted that the graph is 
                            <strong>DIRECTED</strong>).</li>
                        <br>
                        <li>Please input <strong>POSITIVE INTEGER</strong> for scaling.</li>
                    </ol>
                </div>
            </div>
        </div>
        <!--Caculate Figures >
        <%
            String edge = "";
            String node = "";
            String graphFilePath = "";
            try {
                graphFilePath = session.getAttribute("uploadedFilePath").toString();//gets the path of the file which was uploaded
                if (graphFilePath == null
                        || graphFilePath.length() == 0
                        || graphFilePath.equals("")) {//to check if there is any input. 
                    graphFilePath = "";
                }
                //Reads file from where it is locally stored and counts the number if edges and nodes in the original file.
                //When the file is stored in the server,the code to read the file will have to be modified.     
                BufferedReader bi = new BufferedReader(new FileReader(graphFilePath));
                HashMap<Integer, Integer> uidCounts = new HashMap<>();
                HashMap<Integer, Integer> fidCounts = new HashMap<>();
                String line = bi.readLine();
                int nodesize = 77360;
                int edgesize = 0;
                while (line != null) {
                    edgesize++;
                    String[] temp = line.split("\\s+");
                    int fid = Integer.parseInt(temp[0]);
                    int uid = Integer.parseInt(temp[1]);
                    if (fid != uid) {
                        if (uidCounts.containsKey(uid)) {
                            uidCounts.put(uid, uidCounts.get(uid) + 1);
                        } else {
                            uidCounts.put(uid, 1);
                        }
                        if (!uidCounts.containsKey(fid)) {
                            uidCounts.put(fid, 0);
                        }

                        if (fidCounts.containsKey(fid)) {
                            fidCounts.put(fid, fidCounts.get(fid) + 1);
                        } else {
                            fidCounts.put(fid, 1);
                        }
                        if (!fidCounts.containsKey(uid)) {
                            fidCounts.put(uid, 0);
                        }
                    }
                    line = bi.readLine();
                }
                bi.close();
                nodesize = fidCounts.size();
                edge = edgesize + "";
                node = nodesize + "";

                session.setAttribute("originalnode", node);
                session.setAttribute("originaledge", edge);
            } catch (Exception e) {
                e.printStackTrace();
            }
        %> 
        <!-- Container (analysis Section) -->
        <div id="analysis" class="container-fluid bg-grey ">
            <div class="row">
                <div class="col-md-12">
                    <h2>Basic Statistics</h2>
                    <table class="table table-bordered table-inverse">
                        <thead>
                            <tr>
                                <th></th>
                                <th>Node No.</th>
                                <th>Edge No.</th>
                                <th>Effective Diameter</th>
                                <th>Average Shortest Path</th> 
                                <th>Average Clustering Coefficient</th>                                                                                              
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <th scope="row">Original</th>
                                <td><span> <%=node%> </span></td>
                                <td><span> <%=edge%> </span></td>
                                <td><span> <%=node%> </span></td>
                                <td><span> <%=node%> </span></td>
                                <td><span> <%=node%> </span></td>
                            </tr>
                            <tr>
                                <th scope="row">Scaled</th>
                                <td><span> <%=node%> </span></td>
                                <td><span> <%=edge%> </span></td>
                                <td><span> <%=node%> </span></td>
                                <td><span> <%=node%> </span></td>
                                <td><span> <%=node%> </span></td>
                            </tr>
                        </tbody>
                    </table>
                    <form action="DownloadScaledGraph.jsp">                              
                        <input type="submit" value="Download Scaled Graph" style="padding: 8px 16px;" class="btn btndow btn-lg">
                    </form>
                </div>
            </div>
        </div>
        <!-- Container (Contact Section) -->
        <div id ="contact" style="background-color: #334d66; color: white;" class="container-fluid ">
            <h2 style="font-weight: 700" class="text-left ">CONTACT</h2>
            <div class="row ">
                <div class="col-sm-5 ">
                    <p>Contact us and we'll get back to you within 24 hours.</p>
                    <p><span class="glyphicon glyphicon-map-marker "></span> Chicago, US</p>
                    <p><span class="glyphicon glyphicon-phone "></span> +00 1515151515</p>
                    <p><span class="glyphicon glyphicon-envelope "></span> myemail@something.com</p>
                </div>
                <div class="col-sm-7">
                    <div class="row ">
                        <div class="col-sm-6 form-group ">
                            <input class="form-control" id="name" name="name" placeholder="Name" type="text" required>
                        </div>
                        <div class="col-sm-6 form-group ">
                            <input class="form-control" id="email" name="email" placeholder="Email" type="email" required>
                        </div>
                    </div>
                    <textarea class="form-control" id="comments" name="comments" placeholder="Comment" rows="5"></textarea><br>
                    <div class="row ">
                        <div class="col-sm-12 form-group ">
                            <button class="btn btn-default pull-right" type="submit">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div id="contact" class="container-fluid bg-grey">
            <h2 class="text-center">CONTACT</h2>
            <div class="row">
                <div class="col-sm-5">
                    <p>Contact us and we'll get back to you within 24 hours.</p>
                    <p><span class="glyphicon glyphicon-map-marker"></span> Chicago, US</p>
                    <p><span class="glyphicon glyphicon-phone"></span> +00 1515151515</p>
                    <p><span class="glyphicon glyphicon-envelope"></span> myemail@something.com</p>
                </div>
                <div class="col-sm-7 slideanim slide">
                    <div class="row">
                        <div class="col-sm-6 form-group">
                            <input class="form-control" id="name" name="name" placeholder="Name" type="text" required>
                        </div>
                        <div class="col-sm-6 form-group">
                            <input class="form-control" id="email" name="email" placeholder="Email" type="email" required>
                        </div>
                    </div>
                    <textarea class="form-control" id="comments" name="comments" placeholder="Comment" rows="5"></textarea><br>
                    <div class="row">
                        <div class="col-sm-12 form-group">
                            <button class="btn btn-default pull-right" type="submit">Send</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </body>
</html>